<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/blog_template.css/blog-temp.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Banksia Pages</title>
</head>

<body>
    <!-- Add Firebase SDK for Banksia Pages Database -->
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD6KA0ECIAB3scXNUu7mxgjmbmnhjOSEVc",
            authDomain: "banksia-pages-database.firebaseapp.com",
            projectId: "banksia-pages-database",
            storageBucket: "banksia-pages-database.appspot.com",
            messagingSenderId: "239610874789",
            appId: "1:239610874789:web:80bcede53d7ef4ba26764c",
            measurementId: "G-JV3QXR7P2H"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                var userName = user.displayName;
            } else {
                // No user is signed in.
                console.log('No user is signed in');
            }
        });
    </script>

    <!-- Top Navigation Bar -->
    <nav class="top-nav" id="navbar">
        <a class="nav-title" href="#">Banksia<b>Pages</b></a>
        <div class="header-buttons">
            <!-- When user is signed-in add sign out function-->
            <a href="#" id="logoutButton">Log Out</a>
            <script>
                document.getElementById('logoutButton').addEventListener('click', function () {
                    firebase.auth().signOut().then(() => {
                        // Sign-out successful.
                        console.log('User signed out');
                    }).catch((error) => {
                        // An error happened.
                        console.log('Error signing out:', error);
                    });
                });
            </script>
            <!-- Sign out will replace sign in when user is logged in commented out currently
            <a href="#">Sign Out</a> -->
        </div>
        <div class="header-links">
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="blogslist.html">Blogs</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </div>
    </nav>

    <!-- menu class will be on left side with user info-->
    <div class="container-grid">
        <menu class="panel-left">
            <div class="profile-info-container">

                <!-- Link user info to database so it pulls user image instead of pre-selected image in code-->

                <div class="profile-pic-container">
                    <img src="#" alt="Profile Picture">
                </div>

                <h1 class="blog_username">
                </h1>

                <div class="blog_bio">
                    <div class="create-post">
                        <h2><a href="createpost.html">Create Post</a></h2>
                    </div>
        </menu>


        <!-- Blog Post Template -->
        <main class="blog-list">
            <script>
                firebase.auth().onAuthStateChanged(function (user) {
                    if (user) {
                        // User is signed in.
                        var userName = user.displayName; // Get the user's display name

                        // Fetch user data from Firestore
                        db.collection("UserData").doc(userName).get().then((doc) => {
                            if (doc.exists) {
                                // Get user data from the document
                                var userData = doc.data();

                                // Update HTML elements with user data
                                document.querySelector('.profile-pic-container img').src = userData.profilePicture;
                                document.querySelector('.blog_username').textContent = userData.blogUserName;
                                document.querySelector('.blog_bio').textContent = userData.blogBio;

                                // Fetch blogs created by the user from Firestore
                                db.collection('blogPosts').where('blogUserName', '==', userData.blogUserName).get().then((querySnapshot) => {
                                    querySnapshot.forEach((doc) => {
                                        // Get blog data from the document
                                        var blogData = doc.data();

                                        // Check if the blogUserName in the blog post matches the user's display name
                                        if (blogData.blogUserName === userData.blogUserName) {
                                            // Create a new div element for the blog post
                                            var postDiv = document.createElement('div');
                                            postDiv.className = 'blog-post';

                                            // Create HTML elements for the blog title, date, content, and username
                                            var title = document.createElement('h3');
                                            title.textContent = blogData.title;

                                            var date = document.createElement('p');
                                            date.textContent = "Date Created: " + blogData.date;

                                            var content = document.createElement('p');
                                            content.textContent = blogData.content;

                                            var userDiv = document.createElement('div');
                                            userDiv.style.display = 'flex';
                                            userDiv.style.alignItems = 'center';

                                            var username = document.createElement('p');
                                            username.textContent = "Created By: " + " " + blogData.blogUserName;

                                            console.log('Fetching user data for username:', blogData.blogUserName);

                                            // Append the username to the userDiv
                                            userDiv.appendChild(username);

                                            // Append the title, date, content, and userDiv to the postDiv
                                            postDiv.appendChild(title);
                                            postDiv.appendChild(date);
                                            postDiv.appendChild(content);
                                            postDiv.appendChild(userDiv);

                                            // Append the postDiv to the blog post body
                                            var blogPostBody = document.querySelector('.blog-post-body');
                                            blogPostBody.appendChild(postDiv);
                                        }
                                        else {
                                            console.log('No blog posts found for user:', userData.blogUserName);
                                        }
                                    });
                                }).catch((error) => {
                                    console.log('Error getting documents:', error);
                                });
                            } else {
                                // No user is signed in.
                                console.log('No user is signed in');
                            }
                        });
                    } else {
                        // No user is signed in.
                        console.log('No user is signed in');
                    }
                });
            </script>
        </main>
        <footer>
            <p>&copy; 2023 Banksia Pages. All rights reserved.</p>
        </footer>
</body>

</html>