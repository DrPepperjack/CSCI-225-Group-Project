<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../css/themes.css/theme-1.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Banksia Pages</title>
</head>

<body>
    <!-- Add Firebase SDK for Banksia Pages Database -->
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-auth-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD6KA0ECIAB3scXNUu7mxgjmbmnhjOSEVc",
            authDomain: "banksia-pages-database.firebaseapp.com",
            projectId: "banksia-pages-database",
            storageBucket: "banksia-pages-database.appspot.com",
            messagingSenderId: "239610874789",
            appId: "1:239610874789:web:80bcede53d7ef4ba26764c",
            measurementId: "G-JV3QXR7P2H"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <!-- Top Navigation Bar -->
    <nav class="top-nav" id="navbar">
        <a class="nav-title" href="#">Banksia<b>Pages</b></a>
        <div class="header-buttons">
            <!-- When user is signed-in add sign out function-->
            <a href="#">Log Out</a>
            <!-- Sign out will replace sign in when user is logged in commented out currently
            <a href="#">Sign Out</a> -->
        </div>
        <div class="header-links">
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="blogslist.html">Blogs</a></li>
                <li><a href="about.html">About</a></li>
            </ul>
        </div>
    </nav>

    <!-- menu class will be on left side with user info-->
    <div class="container-grid">
        <menu class="panel-left">
            <div class="profile-info-container">

                <!-- Link user info to database so it pulls user image instead of pre-selected image in code-->

                <div class="profile-pic-container">
                    <img src="#" alt="Profile Picture">
                </div>

                <h1 class="blog_username">
                </h1>

                <div class="blog_bio">
                    <div class="create-post">
                        <h2><a href="../createpost.html">Create Post</a></h2>
                    </div>
        </menu>


        <!-- Blog Post Template -->
        <main class="blog-list">
            <div class="blog-post-header">
                <div class="blog-post-title">
                    <h1></h1>
                </div>
                <div class="blog-post-author">
                    <p></p>
                </div>
                <!-- Dynamic date from the database -->
                <div class="blog-post-date">
                    <p></p>
                </div>
                <div class="blog-post-body">
                </div>

                <div class="blog-comments-section">
                    <h2>Blog Comments</h2>
                    <!-- Display existing comments -->
                    <div class="existing-comments">
                        <!-- Dynamic comments will be displayed here -->
                    </div>
                    <div class="view-comments-button">
                        <button type="button">View All Comments</button>
                    </div>
                    <div class="view-full-posts">
                        <button type="button" class="load-more-button">View Post</button>
                    </div>
                </div>
            </div>
        </main>
        <footer>
            <p>&copy; 2023 Banksia Pages. All rights reserved.</p>
        </footer>
        <script>
            firebase.auth().onAuthStateChanged(function (user) {
                if (user) {
                    // User is signed in.
                    var userName = user.displayName; // Get the user's display name

                    // Fetch user data from Firestore
                    db.collection("UserData").doc(userName).get().then((doc) => {
                        if (doc.exists) {
                            // Get user data from the document
                            var userData = doc.data();

                            // Update HTML elements with user data
                            document.querySelector('.profile-pic-container img').src = userData.profilePicture;
                            document.querySelector('.blog_username').textContent = userData.blogUserName;
                            document.querySelector('.blog_bio').textContent = userData.blogBio;
                        } else {
                            console.log('No such document!');
                        }
                    }).catch((error) => {
                        console.log('Error getting document:', error);
                    });

                    // Fetch blogs created by the user from Firestore
                    db.collection('blogPosts').where(firebase.firestore.FieldPath.documentId(), '==', `${userName}-blogTitle`).get().then((querySnapshot) => {
                        querySnapshot.forEach((doc) => {
                            // Get blog data from the document
                            var blogData = doc.data();

                            // Create HTML elements for the blog title, date, and content
                            var title = document.createElement('h1');
                            title.textContent = blogData.blogTitle;

                            var author = document.createElement('p');
                            author.textContent = blogData.blogUserName;

                            var date = document.createElement('p');
                            date.textContent = "Date Created: " + blogData.date;

                            var content = document.createElement('div');
                            content.textContent = blogData.content;

                            // Append the title, author, date, and content to the blog post header
                            var blogPostHeader = document.querySelector('.blog-post-header');
                            blogPostHeader.appendChild(title);
                            blogPostHeader.appendChild(author);
                            blogPostHeader.appendChild(date);
                            blogPostHeader.appendChild(content);
                        });
                    }).catch((error) => {
                        console.log('Error getting documents:', error);
                    });
                } else {
                    // No user is signed in.
                    console.log('No user is signed in');
                }
            });
        </script>
</body>

</html>